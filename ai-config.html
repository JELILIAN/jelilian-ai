<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JELILIAN - AIé…ç½®</title>
    <style>
        body { font-family: system-ui; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #6366f1; margin-bottom: 10px; }
        .config-section { margin: 30px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; }
        .config-section h3 { color: #1f2937; margin-bottom: 15px; }
        .provider-option { display: flex; align-items: center; margin: 15px 0; padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; transition: all 0.3s; }
        .provider-option:hover { border-color: #6366f1; background: #f8fafc; }
        .provider-option.selected { border-color: #6366f1; background: #f0f9ff; }
        .provider-option input[type="radio"] { margin-right: 12px; }
        .provider-info { flex: 1; }
        .provider-name { font-weight: 600; color: #1f2937; margin-bottom: 4px; }
        .provider-desc { color: #6b7280; font-size: 14px; }
        .provider-status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
        .status-available { background: #d1fae5; color: #065f46; }
        .status-need-key { background: #fef3c7; color: #92400e; }
        .api-key-input { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; margin-top: 10px; font-family: monospace; }
        .btn { background: #6366f1; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-weight: 600; margin: 5px; }
        .btn:hover { background: #4f46e5; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .test-area { background: #f8fafc; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .test-result { margin-top: 15px; padding: 15px; border-radius: 6px; }
        .success { background: #d1fae5; color: #065f46; border: 1px solid #10b981; }
        .error { background: #fee2e2; color: #991b1b; border: 1px solid #ef4444; }
        .comparison-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .comparison-table th, .comparison-table td { padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; }
        .comparison-table th { background: #f9fafb; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– JELILIAN AIé…ç½®</h1>
            <p>é€‰æ‹©å’Œé…ç½®æ‚¨çš„AIæœåŠ¡å•†</p>
        </div>
        
        <div class="config-section">
            <h3>ğŸ¯ é€‰æ‹©AIæœåŠ¡å•†</h3>
            
            <div class="provider-option" onclick="selectProvider('mock')">
                <input type="radio" name="provider" value="mock" checked>
                <div class="provider-info">
                    <div class="provider-name">æ¨¡æ‹ŸAI (å½“å‰)</div>
                    <div class="provider-desc">æœ¬åœ°æ¨¡æ‹Ÿå“åº”ï¼Œæ— éœ€APIå¯†é’¥ï¼Œé€‚åˆæ¼”ç¤ºå’Œæµ‹è¯•</div>
                </div>
                <div class="provider-status status-available">å¯ç”¨</div>
            </div>
            
            <div class="provider-option" onclick="selectProvider('openai')">
                <input type="radio" name="provider" value="openai">
                <div class="provider-info">
                    <div class="provider-name">OpenAI GPT</div>
                    <div class="provider-desc">GPT-4, GPT-3.5 ç­‰æ¨¡å‹ï¼Œå¼ºå¤§çš„è¯­è¨€ç†è§£å’Œç”Ÿæˆèƒ½åŠ›</div>
                </div>
                <div class="provider-status status-need-key">éœ€è¦APIå¯†é’¥</div>
            </div>
            
            <div class="provider-option" onclick="selectProvider('qwen')">
                <input type="radio" name="provider" value="qwen">
                <div class="provider-info">
                    <div class="provider-name">é˜¿é‡Œåƒé—®</div>
                    <div class="provider-desc">é˜¿é‡Œäº‘å¤§æ¨¡å‹ï¼Œä¸­æ–‡ç†è§£ä¼˜ç§€ï¼Œä»·æ ¼ç›¸å¯¹ä¾¿å®œ</div>
                </div>
                <div class="provider-status status-need-key">éœ€è¦APIå¯†é’¥</div>
            </div>
            
            <div class="provider-option" onclick="selectProvider('claude')">
                <input type="radio" name="provider" value="claude">
                <div class="provider-info">
                    <div class="provider-name">Anthropic Claude</div>
                    <div class="provider-desc">Claude-3 ç³»åˆ—ï¼Œä¼˜ç§€çš„æ¨ç†èƒ½åŠ›å’Œå®‰å…¨æ€§</div>
                </div>
                <div class="provider-status status-need-key">éœ€è¦APIå¯†é’¥</div>
            </div>
        </div>
        
        <div class="config-section" id="apiKeySection" style="display: none;">
            <h3>ğŸ”‘ APIå¯†é’¥é…ç½®</h3>
            <p>è¯·è¾“å…¥æ‚¨é€‰æ‹©çš„AIæœåŠ¡å•†çš„APIå¯†é’¥ï¼š</p>
            <input type="password" id="apiKeyInput" class="api-key-input" placeholder="è¾“å…¥APIå¯†é’¥...">
            <div style="margin-top: 10px;">
                <button class="btn" onclick="saveApiKey()">ä¿å­˜å¯†é’¥</button>
                <button class="btn btn-secondary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
            </div>
            <div id="keyTestResult"></div>
        </div>
        
        <div class="config-section">
            <h3>ğŸ§ª AIå¯¹è¯æµ‹è¯•</h3>
            <div class="test-area">
                <input type="text" id="testMessage" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯..." style="width: 70%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                <button class="btn" onclick="testAI()" style="width: 25%;">æµ‹è¯•AI</button>
                <div id="testResult"></div>
            </div>
        </div>
        
        <div class="config-section">
            <h3>ğŸ“Š AIæœåŠ¡å•†å¯¹æ¯”</h3>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æœåŠ¡å•†</th>
                        <th>ä¼˜åŠ¿</th>
                        <th>ä»·æ ¼</th>
                        <th>ä¸­æ–‡æ”¯æŒ</th>
                        <th>æ¨èåœºæ™¯</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>æ¨¡æ‹ŸAI</strong></td>
                        <td>å…è´¹ã€å¿«é€Ÿã€æ— é™åˆ¶</td>
                        <td>å…è´¹</td>
                        <td>â­â­â­</td>
                        <td>æ¼”ç¤ºã€æµ‹è¯•</td>
                    </tr>
                    <tr>
                        <td><strong>OpenAI GPT</strong></td>
                        <td>åŠŸèƒ½å¼ºå¤§ã€ç”Ÿæ€å®Œå–„</td>
                        <td>è¾ƒé«˜</td>
                        <td>â­â­â­â­</td>
                        <td>å¤æ‚ä»»åŠ¡ã€åˆ›æ„å†™ä½œ</td>
                    </tr>
                    <tr>
                        <td><strong>é˜¿é‡Œåƒé—®</strong></td>
                        <td>ä¸­æ–‡ä¼˜ç§€ã€ä»·æ ¼ä¾¿å®œ</td>
                        <td>è¾ƒä½</td>
                        <td>â­â­â­â­â­</td>
                        <td>ä¸­æ–‡å†…å®¹ã€æˆæœ¬æ•æ„Ÿ</td>
                    </tr>
                    <tr>
                        <td><strong>Claude</strong></td>
                        <td>æ¨ç†èƒ½åŠ›å¼ºã€å®‰å…¨æ€§é«˜</td>
                        <td>ä¸­ç­‰</td>
                        <td>â­â­â­â­</td>
                        <td>åˆ†æä»»åŠ¡ã€ä»£ç ç”Ÿæˆ</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="applyConfig()">åº”ç”¨é…ç½®</button>
            <button class="btn btn-secondary" onclick="resetConfig()">é‡ç½®é…ç½®</button>
        </div>
    </div>

    <script src="real-ai-integration.js"></script>
    <script>
        let currentProvider = 'mock';
        let aiIntegration = null;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedConfig();
        });
        
        function selectProvider(provider) {
            currentProvider = provider;
            document.querySelector(`input[value="${provider}"]`).checked = true;
            
            // æ˜¾ç¤ºæˆ–éšè—APIå¯†é’¥é…ç½®
            const apiKeySection = document.getElementById('apiKeySection');
            if (provider === 'mock') {
                apiKeySection.style.display = 'none';
            } else {
                apiKeySection.style.display = 'block';
                document.getElementById('apiKeyInput').placeholder = `è¾“å…¥${getProviderName(provider)}çš„APIå¯†é’¥...`;
            }
        }
        
        function getProviderName(provider) {
            const names = {
                'openai': 'OpenAI',
                'qwen': 'é˜¿é‡Œåƒé—®',
                'claude': 'Claude',
                'mock': 'æ¨¡æ‹ŸAI'
            };
            return names[provider] || provider;
        }
        
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('è¯·è¾“å…¥APIå¯†é’¥');
                return;
            }
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem(`jelilian_${currentProvider}_key`, apiKey);
            
            // åˆå§‹åŒ–AIé›†æˆ
            if (!aiIntegration) {
                aiIntegration = new RealAIIntegration();
            }
            aiIntegration.setApiKey(currentProvider, apiKey);
            
            alert('APIå¯†é’¥å·²ä¿å­˜');
        }
        
        async function testConnection() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                alert('è¯·å…ˆè¾“å…¥APIå¯†é’¥');
                return;
            }
            
            const resultDiv = document.getElementById('keyTestResult');
            resultDiv.innerHTML = '<div style="color: #6b7280;">æ­£åœ¨æµ‹è¯•è¿æ¥...</div>';
            
            try {
                if (!aiIntegration) {
                    aiIntegration = new RealAIIntegration();
                }
                aiIntegration.setApiKey(currentProvider, apiKey);
                
                // é’ˆå¯¹ä¸åŒæœåŠ¡å•†ä½¿ç”¨ä¸åŒçš„æµ‹è¯•æ¶ˆæ¯
                let testMessage = 'Hello';
                if (currentProvider === 'qwen') {
                    testMessage = 'ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±';
                }
                
                const response = await aiIntegration.chat(testMessage, { 
                    provider: currentProvider,
                    maxTokens: 100
                });
                
                if (response.success) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            âœ… è¿æ¥æˆåŠŸï¼<br>
                            <strong>æ¨¡å‹:</strong> ${response.model}<br>
                            <strong>æœåŠ¡å•†:</strong> ${getProviderName(currentProvider)}<br>
                            ${response.tokens ? `<strong>ä½¿ç”¨Token:</strong> ${response.tokens}` : ''}
                        </div>
                    `;
                } else {
                    let errorMsg = response.error;
                    let suggestion = '';
                    
                    // é’ˆå¯¹é˜¿é‡Œåƒé—®çš„ç‰¹æ®Šé”™è¯¯å¤„ç†
                    if (currentProvider === 'qwen') {
                        if (response.error.includes('401')) {
                            suggestion = '<br><strong>å»ºè®®:</strong> æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ä»¥"sk-"å¼€å¤´';
                        } else if (response.error.includes('403')) {
                            suggestion = '<br><strong>å»ºè®®:</strong> æ£€æŸ¥è´¦æˆ·ä½™é¢å’ŒAPIæƒé™';
                        } else if (response.error.includes('CORS')) {
                            suggestion = '<br><strong>å»ºè®®:</strong> è¯·åœ¨æœ¬åœ°æœåŠ¡å™¨ç¯å¢ƒä¸­è¿è¡Œ (python -m http.server 8000)';
                        }
                    }
                    
                    resultDiv.innerHTML = `
                        <div class="test-result error">
                            âŒ è¿æ¥å¤±è´¥ï¼š${errorMsg}${suggestion}
                            <br><br>
                            <button onclick="openDebugTool()" style="background:#f59e0b;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;">
                                ğŸ”§ æ‰“å¼€è°ƒè¯•å·¥å…·
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        âŒ æµ‹è¯•å¤±è´¥ï¼š${error.message}
                        <br><br>
                        <button onclick="openDebugTool()" style="background:#f59e0b;color:white;border:none;padding:8px 16px;border-radius:4px;cursor:pointer;">
                            ğŸ”§ æ‰“å¼€è°ƒè¯•å·¥å…·
                        </button>
                    </div>
                `;
            }
        }
        
        function openDebugTool() {
            if (currentProvider === 'qwen') {
                window.open('qwen-debug.html', '_blank');
            } else {
                alert('è°ƒè¯•å·¥å…·ç›®å‰åªæ”¯æŒé˜¿é‡Œåƒé—®API');
            }
        }
        
        async function testAI() {
            const message = document.getElementById('testMessage').value.trim();
            if (!message) {
                alert('è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯');
                return;
            }
            
            const resultDiv = document.getElementById('testResult');
            resultDiv.innerHTML = '<div style="color: #6b7280; margin-top: 15px;">AIæ­£åœ¨æ€è€ƒ...</div>';
            
            try {
                let response;
                
                if (currentProvider === 'mock') {
                    // ä½¿ç”¨æ¨¡æ‹ŸAI
                    response = {
                        success: true,
                        text: `è¿™æ˜¯æ¨¡æ‹ŸAIçš„å›å¤ï¼šæˆ‘ç†è§£æ‚¨è¯´çš„"${message}"ã€‚ä½œä¸ºJELILIAN AIåŠ©æ‰‹ï¼Œæˆ‘å¯ä»¥å¸®æ‚¨åˆ›å»ºç½‘ç«™ã€ç”Ÿæˆå†…å®¹ç­‰ã€‚`,
                        provider: 'mock'
                    };
                } else {
                    // ä½¿ç”¨çœŸå®AI
                    if (!aiIntegration) {
                        throw new Error('è¯·å…ˆé…ç½®APIå¯†é’¥');
                    }
                    response = await aiIntegration.chat(message, { provider: currentProvider });
                }
                
                if (response.success) {
                    resultDiv.innerHTML = `
                        <div class="test-result success">
                            <strong>âœ… ${getProviderName(currentProvider)}å›å¤ï¼š</strong><br>
                            ${response.text}
                            ${response.tokens ? `<br><small>ä½¿ç”¨Token: ${response.tokens}</small>` : ''}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="test-result error">âŒ è¯·æ±‚å¤±è´¥ï¼š${response.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="test-result error">âŒ æµ‹è¯•å¤±è´¥ï¼š${error.message}</div>`;
            }
        }
        
        function applyConfig() {
            // ä¿å­˜é…ç½®
            localStorage.setItem('jelilian_provider', currentProvider);
            
            alert(`é…ç½®å·²åº”ç”¨ï¼å½“å‰ä½¿ç”¨ï¼š${getProviderName(currentProvider)}`);
            
            // å¯ä»¥è·³è½¬å›ä¸»é¡µé¢
            if (confirm('æ˜¯å¦è¿”å›ä¸»é¡µé¢ï¼Ÿ')) {
                window.location.href = 'index.html';
            }
        }
        
        function resetConfig() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿ')) {
                localStorage.removeItem('jelilian_provider');
                localStorage.removeItem('jelilian_openai_key');
                localStorage.removeItem('jelilian_qwen_key');
                localStorage.removeItem('jelilian_claude_key');
                
                selectProvider('mock');
                document.getElementById('apiKeyInput').value = '';
                document.getElementById('keyTestResult').innerHTML = '';
                document.getElementById('testResult').innerHTML = '';
                
                alert('é…ç½®å·²é‡ç½®');
            }
        }
        
        function loadSavedConfig() {
            const savedProvider = localStorage.getItem('jelilian_provider') || 'mock';
            selectProvider(savedProvider);
            
            // åŠ è½½ä¿å­˜çš„APIå¯†é’¥
            if (savedProvider !== 'mock') {
                const savedKey = localStorage.getItem(`jelilian_${savedProvider}_key`);
                if (savedKey) {
                    document.getElementById('apiKeyInput').value = savedKey;
                }
            }
        }
    </script>
</body>
</html>